<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" width="1200" height="2200" viewBox="0 0 1200 2200">
  <style>
    .bg { fill: #ffffff }
    .rect { fill: #f6f7ff; stroke: #6c4df5; stroke-width:2; rx:10 }
    .rect-strong { fill: #efe9ff; stroke: #4b2fcf; stroke-width:2; rx:10 }
    .diamond { fill:#fff; stroke:#4b2fcf; stroke-width:2 }
    .arrow { stroke:#6c4df5; stroke-width:3; fill:none; marker-end:url(#arrow) }
    .text { font-family: Inter, Arial, sans-serif; fill:#0b1226 }
    .small { font-size:14px }
    .large { font-size:18px; font-weight:600 }
    .icon { fill:#6c4df5 }
  </style>

  <rect class="bg" x="0" y="0" width="1200" height="2200" />

  <defs>
    <marker id="arrow" markerWidth="10" markerHeight="10" refX="10" refY="5" orient="auto">
      <path d="M0,0 L10,5 L0,10 z" fill="#6c4df5"/>
    </marker>
  </defs>

  <!-- Title -->
  <text class="text large" x="60" y="40">Face Enrollment and Liveness-based Voting Verification</text>

  <!-- Enrollment column -->
  <g transform="translate(60,80)">
    <text class="text" x="0" y="0">Phase 1 — Face Enrollment (after ID Verification)</text>

    <!-- Start -->
    <rect class="rect" x="0" y="30" width="420" height="48" />
    <text class="text" x="20" y="60">Start → ID Verified</text>

    <!-- Open Face Enrollment -->
    <line class="arrow" x1="210" y1="78" x2="210" y2="120" />
    <rect class="rect-strong" x="0" y="120" width="420" height="60" />
    <text class="text" x="20" y="156">Open Face Enrollment Screen (instructions)</text>

    <!-- Capture steps -->
    <line class="arrow" x1="210" y1="180" x2="210" y2="240" />

    <g transform="translate(0,240)">
      <rect class="rect" x="0" y="0" width="420" height="44" />
      <text class="text" x="20" y="30">Capture Front Face</text>

      <line class="arrow" x1="210" y1="44" x2="210" y2="92" />

      <rect class="rect" x="0" y="92" width="420" height="44" />
      <text class="text" x="20" y="122">Capture Left Face</text>

      <line class="arrow" x1="210" y1="136" x2="210" y2="184" />

      <rect class="rect" x="0" y="184" width="420" height="44" />
      <text class="text" x="20" y="214">Capture Right Face</text>

      <line class="arrow" x1="210" y1="228" x2="210" y2="276" />

      <rect class="rect" x="0" y="276" width="420" height="44" />
      <text class="text" x="20" y="306">Capture Top (Up) Face</text>

      <line class="arrow" x1="210" y1="320" x2="210" y2="368" />

      <rect class="rect" x="0" y="368" width="420" height="44" />
      <text class="text" x="20" y="398">Capture Bottom (Down) Face</text>

      <line class="arrow" x1="210" y1="412" x2="210" y2="470" />

      <rect class="rect-strong" x="0" y="470" width="420" height="64" />
      <text class="text" x="20" y="502">Quality & Liveness Check (face detected, sharpness, blink/head move)</text>

      <line class="arrow" x1="210" y1="534" x2="210" y2="590" />

      <rect class="rect" x="0" y="590" width="420" height="56" />
      <text class="text" x="20" y="628">Create Face Profile (store multi-angle embeddings)</text>

      <line class="arrow" x1="210" y1="646" x2="210" y2="700" />

      <rect class="rect" x="0" y="700" width="420" height="44" />
      <text class="text" x="20" y="730">Face Enrollment Completed (faceEnrolled = true)</text>
    </g>
  </g>

  <!-- Voting column -->
  <g transform="translate(520,80)">
    <text class="text">Phase 2 — Liveness & Voting</text>

    <rect class="rect" x="0" y="30" width="560" height="48" />
    <text class="text" x="20" y="60">Start Voting → check idVerified && faceEnrolled && !isBlocked</text>

    <line class="arrow" x1="280" y1="78" x2="280" y2="120" />

    <rect class="rect-strong" x="0" y="120" width="560" height="64" />
    <text class="text" x="20" y="152">Camera & Mic On (consent). Show message: keep face only in frame</text>

    <line class="arrow" x1="280" y1="184" x2="280" y2="240" />

    <rect class="rect" x="0" y="240" width="560" height="84" />
    <text class="text" x="20" y="276">Real-time Analysis (every 1–2s): face match vs stored embeddings, liveness, multi-person, mask, audio</text>

    <line class="arrow" x1="280" y1="324" x2="280" y2="380" />

    <!-- Decision diamond -->
    <g transform="translate(200,380)">
      <polygon class="diamond" points="80,0 160,80 80,160 0,80" />
      <text class="text" x="50" y="90" text-anchor="middle">Any Rule Violation?</text>
    </g>

    <!-- No path -->
    <line class="arrow" x1="280" y1="540" x2="560" y2="540" />
    <rect class="rect" x="560" y="500" width="240" height="64" />
    <text class="text" x="580" y="540">No → Allow Vote & Submit Ballot</text>

    <!-- Yes path (down) -->
    <line class="arrow" x1="280" y1="460" x2="280" y2="520" />

    <g transform="translate(0,560)">
      <rect class="rect" x="0" y="0" width="560" height="48" />
      <text class="text" x="20" y="32">Warning 1 (show reason, yellow highlight)</text>
      <line class="arrow" x1="280" y1="48" x2="280" y2="108" />

      <rect class="rect" x="0" y="108" width="560" height="48" />
      <text class="text" x="20" y="140">Warning 2 (pause submit briefly)</text>
      <line class="arrow" x1="280" y1="156" x2="280" y2="216" />

      <rect class="rect-strong" x="0" y="216" width="560" height="64" />
      <text class="text" x="20" y="248">Third violation or severe → Mark Vote INVALID, Block user, Notify user & admin, save logs/evidence</text>
    </g>
  </g>

  <!-- Footer note -->
  <text class="text small" x="60" y="2100">Icons: camera = capture, database = storage, warning = notifications. Retain evidence only with consent and follow privacy policy.</text>
</svg>